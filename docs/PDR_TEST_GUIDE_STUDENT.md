# PDR 시스템 테스트 가이드

> ⏱️ **소요 시간**: 약 20-30분
> 🌐 **테스트 사이트**: https://university-attendance-management-sy.vercel.app
> 👥 **참여 인원**: 학생 1명 + 교수 1명 (또는 교수 역할 대리)

---

## 📱 준비물

- [ ] 스마트폰 2대 (학생용 1대, 교수용 1대)
- [ ] 인터넷 연결 (WiFi 또는 LTE/5G)
- [ ] 실외 공간 접근 가능 (건물 밖)
- [ ] 실내 공간 접근 가능 (건물 안)
- [ ] (선택) PC/Mac - 스마트폰 콘솔 확인용

---

## 🎯 테스트 목표

오늘 추가한 **GPS-PDR 융합 시스템**이 제대로 작동하는지 확인:

### 학생 관점 ✅
1. GPS + PDR 융합 모드로 작동하는가?
2. 실내/실외 환경을 자동으로 감지하는가?
3. 30초마다 위치 추적이 되는가?
4. 조퇴 처리가 자동으로 되는가?

### 교수 관점 ✅
1. 실시간 출석 현황이 보이는가?
2. 30초마다 자동 갱신되는가?
3. 학생 상태(출석/조퇴)가 실시간으로 업데이트되는가?
4. 위치 인증 여부가 표시되는가?

---

## 📋 테스트 순서

이 가이드는 **2개 파트**로 구성됩니다:

1. **파트 A - 학생용 테스트**: 학생 계정으로 테스트
2. **파트 B - 교수용 테스트**: 교수 계정으로 테스트
3. **파트 C - 협업 테스트**: 학생 + 교수가 동시에 확인

---

# 파트 A - 학생용 테스트 👨‍🎓

## 1단계: 출석 체크하기 (3분)

### 사전 준비
교수가 먼저 QR 코드를 생성해야 합니다 (파트 B 참고).

### 학생 테스트
1. **스마트폰**으로 https://university-attendance-management-sy.vercel.app 접속
2. **학생 로그인**
   - ID: `stu001`
   - PW: `stu001`
3. **QR 스캔** 후 출석 체크 완료
4. 출석 페이지가 표시됨

**✅ 확인 포인트:**
- [ ] 로그인 성공
- [ ] QR 스캔 성공
- [ ] "출석 체크" 페이지로 이동
- [ ] 출석 상태: "✅ 출석" 표시

---

## 2단계: PDR 융합 모드 확인 (5분)

### 방법 1: 화면에서 확인 (간단)

출석 페이지에서 확인 가능:
```
실시간 위치 추적
상태: 강의실 범위 내에 있습니다.
마지막 업데이트: 14:25:30
```

**✅ 확인 포인트:**
- [ ] "실시간 위치 추적" 섹션이 보임
- [ ] 30초마다 "마지막 업데이트" 시간이 바뀜
- [ ] 현재 위치 좌표가 표시됨

### 방법 2: 콘솔에서 확인 (상세)

#### 📱 iPhone (Safari)

1. **Mac에서**:
   - Safari 열기 → 메뉴바 "개발" 클릭
   - "개발" 메뉴가 안 보이면: Safari > 설정 > 고급 > "메뉴 막대에서 개발자용 메뉴 보기" 체크

2. **iPhone에서**:
   - 설정 > Safari > 고급 > "웹 속성" 켜기

3. **연결**:
   - iPhone을 Mac에 USB 연결
   - Mac Safari > 개발 > [내 iPhone] > 출석 페이지 선택
   - 콘솔 탭 클릭

#### 📱 Android (Chrome)

1. **스마트폰에서**:
   - 설정 > 개발자 옵션 > USB 디버깅 켜기

2. **PC에서**:
   - Chrome 열기
   - 주소창에 `chrome://inspect` 입력
   - 스마트폰을 USB로 연결
   - "Inspect" 버튼 클릭

#### 콘솔 메시지

**✅ 성공 시 보이는 메시지:**
```
🔄 GPS+PDR Fusion Manager 초기화 중...
✅ GPS+PDR Fusion 초기화 완료: { initialPosition: {...}, accuracy: 12.5 }
💓 Heartbeat [foreground]: 김학생 (37.123456, 127.123456) [fusion, outdoor, conf: 0.85]
```

**확인 포인트:**
- [ ] `GPS+PDR Fusion 초기화 완료` 메시지
- [ ] `[fusion, ...]` 또는 `[pdr-only, ...]` 표시 (GPS+PDR 작동 중)
- [ ] `outdoor` 또는 `indoor` 표시 (환경 자동 감지)
- [ ] 30초마다 `Heartbeat` 메시지

---

## 3단계: 실내/실외 전환 테스트 (10분) ⭐ 중요!

### A. 실외에서 시작 (건물 밖)

1. **건물 밖**으로 나가기 (운동장, 주차장 등)
2. **30초 대기** (Heartbeat 1회)
3. **콘솔 확인**:
   ```
   💓 Heartbeat: ... [fusion, outdoor, conf: 0.85]
   ```

**✅ 체크:**
- [ ] `outdoor` 표시 확인
- [ ] 30초마다 메시지 나옴

### B. 건물 안으로 이동

1. **건물 안으로** 들어가기 (강의실, 복도)
2. **1-2분 대기** (Heartbeat 2-4회)
3. **콘솔 확인** - 환경이 바뀌는지 주목!
   ```
   // 처음엔 outdoor
   💓 Heartbeat: ... [fusion, outdoor, conf: 0.70]

   // 1-2분 후 자동으로 indoor로 변경!
   💓 Heartbeat: ... [fusion, indoor, conf: 0.65]
   ```

**✅ 체크:**
- [ ] `outdoor` → `indoor`로 자동 변경
- [ ] `pdr-only` 또는 `fusion` 모드 유지

### C. 다시 실외로

1. **건물 밖**으로 나가기
2. **1-2분 대기**
3. **콘솔 확인**:
   ```
   💓 Heartbeat: ... [fusion, outdoor, conf: 0.82]
   ```

**✅ 체크:**
- [ ] `indoor` → `outdoor`로 다시 변경

---

## 4단계: 조퇴 테스트 (선택, 5분)

### 목적
강의실 범위를 벗어나면 자동으로 조퇴 처리되는지 확인

### 방법
1. 출석 체크 완료 후
2. **강의실 범위 밖**으로 이동 (100m 이상)
3. **2분 대기** (연속 2회 위치 이탈 감지 필요)
4. **화면 확인**

**✅ 예상 결과:**
```
🚪 강의실 범위를 벗어나 조퇴 처리되었습니다.

출석 상태: 🚪 조퇴
```

**확인 포인트:**
- [ ] 조퇴 알림 메시지 표시
- [ ] 출석 상태가 "조퇴"로 변경
- [ ] 실시간 위치 추적 중지

---

# 파트 B - 교수용 테스트 👨‍🏫

## 1단계: QR 코드 생성 (3분)

1. **PC 또는 스마트폰**으로 https://university-attendance-management-sy.vercel.app 접속
2. **교수 로그인**
   - ID: `prof001`
   - PW: `prof001`
3. **"강의 시작"** 버튼 클릭
4. 강의 선택 후 **"QR 생성"** 클릭

**✅ 확인 포인트:**
- [ ] QR 코드가 화면에 표시됨
- [ ] 세션 정보 표시 (강의명, 날짜, 유효시간)
- [ ] QR 코드 스캔 가능

---

## 2단계: 실시간 출석 현황 페이지 열기 (2분)

### 방법 1: QR 페이지에서
QR 생성 후 → **"실시간 출석 현황 보기"** 버튼 클릭

### 방법 2: 메인 대시보드에서
교수 메인 페이지 → "현재 진행 중인 수업" → **"상세보기"** 버튼 클릭

**✅ 확인 포인트:**
- [ ] 실시간 출석 현황 페이지 열림
- [ ] URL: `/professor/dashboard/[세션ID]`

---

## 3단계: 통계 카드 확인 (1분)

페이지 상단에 4개의 카드가 표시됩니다:

```
┌─────────┬─────────┬─────────┬─────────┐
│ 총 학생 │  출석   │ 지각/조퇴│ 출석률  │
│   30    │   25    │    2    │  83%   │
└─────────┴─────────┴─────────┴─────────┘
```

**✅ 확인 포인트:**
- [ ] 총 학생 수 표시
- [ ] 출석 인원 표시
- [ ] 지각/조퇴 인원 표시 (합산)
- [ ] 출석률 % 표시

---

## 4단계: 학생별 출석 현황 테이블 확인 (2분)

### 테이블 구조

| 학생 | 학번 | 상태 | 체크인 시간 | 위치 인증 | 마지막 업데이트 |
|------|------|------|------------|----------|----------------|
| 김학생 | 2021001 | ✅ 출석 | 09:15:23 | ✅ 인증됨 | 09:45:10 |
| 이학생 | 2021002 | 🚪 조퇴 | 09:16:05 | ✅ 인증됨 | 10:10:32 |

**✅ 확인 포인트:**
- [ ] 학생 이름과 학번 표시
- [ ] 상태 배지 (출석/지각/조퇴/결석)
- [ ] 체크인 시간 표시
- [ ] 위치 인증 여부 (✅/❌)
- [ ] 마지막 업데이트 시간

---

## 5단계: 자동 갱신 확인 (1분)

페이지 우측 상단에 **"마지막 업데이트"** 시간이 표시됩니다.

**✅ 확인 포인트:**
- [ ] 30초마다 자동으로 시간 업데이트
- [ ] 페이지를 새로고침하지 않아도 데이터 갱신됨

---

## 6단계: 조퇴 감지 확인 (선택, 5분)

학생이 조퇴 테스트를 진행할 때 교수 페이지에서 확인합니다.

### 확인 방법
1. 학생이 강의실 범위를 벗어남
2. **교수 페이지를 그대로 켜 둠** (자동 갱신 대기)
3. **2-3분 후** (30초 자동 갱신 2-4회)
4. 학생 상태 변경 확인

**✅ 예상 결과:**
```
상태: ✅ 출석 → 🚪 조퇴 (빨간색 배지)
마지막 업데이트: 시간 업데이트됨
```

**확인 포인트:**
- [ ] 학생 상태가 "출석" → "조퇴"로 자동 변경
- [ ] 조퇴 배지가 빨간색으로 표시
- [ ] 통계 카드의 "지각/조퇴" 숫자 증가
- [ ] 출석률 % 감소

---

# 파트 C - 협업 테스트 👥

학생과 교수가 **동시에** 진행하는 통합 테스트입니다.

## 시나리오 1: 실시간 출석 확인

### 준비
- **교수**: 실시간 출석 현황 페이지 열기
- **학생**: 로그인만 하고 대기

### 진행
1. **학생**: QR 스캔하여 출석 체크
2. **교수**: 30초 이내에 화면 확인

**✅ 교수가 확인할 것:**
- [ ] 테이블에 학생 이름 추가됨
- [ ] 상태: "✅ 출석"
- [ ] 체크인 시간 표시
- [ ] 총 학생 수 / 출석 인원 증가

---

## 시나리오 2: 실시간 조퇴 감지

### 준비
- **학생**: 출석 체크 완료
- **교수**: 실시간 출석 현황 페이지에서 학생 상태 "✅ 출석" 확인

### 진행
1. **학생**: 강의실 범위 밖으로 이동 (100m+)
2. **학생**: 2분 대기
3. **학생**: 스마트폰에서 조퇴 알림 확인
4. **교수**: 30초 자동 갱신 후 화면 확인

**✅ 교수가 확인할 것:**
- [ ] 학생 상태: "✅ 출석" → "🚪 조퇴"
- [ ] 조퇴 배지 빨간색 표시
- [ ] 마지막 업데이트 시간 변경
- [ ] 통계 카드 업데이트 (지각/조퇴 +1)

**✅ 학생이 확인할 것:**
- [ ] 조퇴 알림 메시지
- [ ] 출석 상태 "🚪 조퇴"로 변경
- [ ] 실시간 위치 추적 중지

---

## 시나리오 3: 실내/실외 전환 확인

### 준비
- **학생**: 출석 체크 완료 (실외)
- **교수**: 실시간 출석 현황 페이지 열기

### 진행
1. **학생**: 건물 밖 → 건물 안으로 이동
2. **학생**: 콘솔에서 `outdoor` → `indoor` 변경 확인
3. **교수**: 학생 "마지막 업데이트" 시간 확인

**✅ 확인 포인트:**
- [ ] 학생: 환경 자동 감지 작동 (`outdoor` → `indoor`)
- [ ] 학생: PDR 모드 전환 (`gps-only` → `fusion`/`pdr-only`)
- [ ] 교수: 30초마다 "마지막 업데이트" 시간 갱신
- [ ] 교수: 위치 인증 상태 유지 (✅ 인증됨)

---

# 📋 테스트 결과 판정

## 학생 테스트 ✅

### 🎉 성공 (PDR 시스템 정상 작동)

- [x] GPS+PDR Fusion 초기화 완료
- [x] 30초마다 Heartbeat 메시지
- [x] `[fusion, ...]` 또는 `[pdr-only, ...]` 표시
- [x] `outdoor` / `indoor` 환경 자동 감지
- [x] 실외 → 실내 → 실외 전환 시 자동 변경

### ⚠️ 부분 성공 (GPS만 작동)

- [x] Heartbeat는 나오지만
- [ ] `[gps-only, ...]`로만 표시
- [ ] 환경 감지는 되지만 fusion 안 됨

→ PDR 센서 문제. 센서 권한 확인 필요.

### ❌ 실패

- [ ] GPS+PDR Fusion 초기화 안 됨
- [ ] Heartbeat가 30초마다 안 나옴
- [ ] 환경이 계속 `unknown`

→ 개발자에게 문의

---

## 교수 테스트 ✅

### 🎉 성공

- [x] 실시간 출석 현황 페이지 정상 표시
- [x] 30초마다 자동 갱신
- [x] 학생 상태 실시간 업데이트
- [x] 조퇴 자동 감지 및 표시
- [x] 통계 카드 실시간 업데이트

### ❌ 실패

- [ ] 출석 현황 페이지가 열리지 않음
- [ ] 자동 갱신이 작동하지 않음
- [ ] 학생 상태가 업데이트되지 않음

→ 개발자에게 문의

---

# 📝 테스트 보고서 양식

테스트 완료 후 작성:

```markdown
## PDR 시스템 테스트 결과

**테스트 일시**: 2025-10-31 14:00
**테스터 (학생)**: 홍길동
**테스터 (교수)**: 김교수
**기기**: iPhone 14 / Galaxy S23
**테스트 장소**: 캠퍼스 A동 + 운동장

---

### 파트 A - 학생 테스트

#### 1. PDR 융합 초기화
- [ ] `GPS+PDR Fusion 초기화 완료` 메시지 확인
- [ ] 초기 GPS 정확도: _____m

#### 2. Heartbeat 작동
- [ ] 30초마다 메시지 나옴
- [ ] tracking_mode: fusion / pdr-only / gps-only

#### 3. 실내/실외 전환
- [ ] 실외: environment = 'outdoor'
- [ ] 실내 이동 후: environment = 'indoor'
- [ ] 다시 실외: environment = 'outdoor'

#### 4. 조퇴 테스트
- [ ] 범위 이탈 시 조퇴 알림 표시
- [ ] 출석 상태 "조퇴"로 변경
- [ ] 위치 추적 중지

---

### 파트 B - 교수 테스트

#### 1. QR 생성
- [ ] QR 코드 정상 표시
- [ ] 세션 정보 표시

#### 2. 실시간 출석 현황
- [ ] 페이지 정상 열림
- [ ] 통계 카드 표시 (총 학생, 출석, 지각/조퇴, 출석률)

#### 3. 자동 갱신
- [ ] 30초마다 "마지막 업데이트" 시간 변경
- [ ] 페이지 새로고침 없이 데이터 갱신

#### 4. 조퇴 감지
- [ ] 학생 조퇴 시 상태 자동 변경
- [ ] 조퇴 배지 빨간색 표시
- [ ] 통계 카드 업데이트

---

### 파트 C - 협업 테스트

#### 시나리오 1: 실시간 출석 확인
- [ ] 학생 출석 체크 즉시 교수 페이지에 반영

#### 시나리오 2: 실시간 조퇴 감지
- [ ] 학생 조퇴 시 교수 페이지 자동 업데이트

#### 시나리오 3: 실내/실외 전환
- [ ] 학생 환경 전환 시 위치 인증 유지

---

### 종합 판정

**학생 테스트:**
- [ ] ✅ 성공 - PDR 시스템 정상 작동
- [ ] ⚠️ 부분 성공 - GPS만 작동 (PDR 안 됨)
- [ ] ❌ 실패 - 작동 안 함

**교수 테스트:**
- [ ] ✅ 성공 - 실시간 모니터링 정상 작동
- [ ] ❌ 실패 - 작동 안 함

---

### 발견된 문제
- (있으면 작성)

### 특이사항
- (있으면 작성)
```

---

# 🔧 자주 발생하는 문제

## 학생 관련 문제

### 문제 1: "Fusion 초기화" 메시지가 안 나옴

**원인**: PDR이 비활성화됨

**확인**:
```javascript
// 콘솔에서 찾아보기
⚠️ PDR Fusion 비활성화: GPS 전용 모드 사용
```

**해결**: 개발자가 설정 확인 필요

---

### 문제 2: 환경이 계속 'unknown'

**원인**: GPS 신호가 너무 약함

**해결**:
1. 건물 밖으로 나가기
2. 1-2분 대기 (GPS 신호 안정화)
3. 비행기 모드 껐다 켜기

---

### 문제 3: tracking_mode가 계속 'gps-only'

**원인**:
- 실외에서 GPS 신호가 너무 좋음 (정상)
- 또는 PDR 센서가 작동 안 함

**확인**: 건물 안으로 들어가서 재확인
- 건물 안에서도 'gps-only'면 → PDR 문제
- 건물 안에서 'fusion' 또는 'pdr-only'로 바뀌면 → 정상

---

## 교수 관련 문제

### 문제 1: 실시간 출석 현황 페이지가 안 열림

**원인**: 세션이 활성화되지 않음

**해결**:
1. QR 생성이 완료되었는지 확인
2. 세션 상태가 "active"인지 확인
3. 페이지 새로고침 후 재시도

---

### 문제 2: 자동 갱신이 안 됨

**원인**: JavaScript 오류 또는 네트워크 문제

**해결**:
1. 브라우저 콘솔에서 오류 확인
2. 페이지 새로고침
3. 다른 브라우저로 시도

---

### 문제 3: 학생 상태가 업데이트되지 않음

**원인**:
- 학생이 heartbeat를 보내지 않음
- API 오류

**해결**:
1. 학생 스마트폰에서 위치 권한 확인
2. 학생이 출석 페이지를 열어두고 있는지 확인
3. 네트워크 연결 확인

---

# 🎓 참고: PDR 시스템이란?

**간단히:**
- **GPS**: 실외에서 정확, 실내에서 부정확
- **PDR**: 스마트폰 센서로 걸음 세서 위치 계산
- **융합**: 둘을 합쳐서 실내외 모두 정확하게!

**오늘 추가한 기능:**
1. GPS Kalman Filter (GPS 노이즈 제거)
2. PDR Tracker (걸음 감지 및 추적)
3. Complementary Filter (GPS와 PDR 융합)
4. Environment Detector (실내/실외 자동 감지)
5. **실시간 모니터링** (교수 페이지)

**기대 효과:**
- 위치 정확도 30-50% 향상
- 실내에서도 연속 추적 가능
- GPS 신호 약해도 센서로 보완
- 교수가 학생 위치를 실시간으로 모니터링

---

# 📞 버그 신고

테스트 중 문제 발견 시:

1. **콘솔 메시지 스크린샷** 찍기 (학생/교수 모두)
2. **어떤 상황**에서 발생했는지 메모
3. **테스트 보고서** 작성
4. 개발자/관리자에게 전달

---

**테스트 사이트**: https://university-attendance-management-sy.vercel.app
**문서 업데이트**: 2025-10-31
**버전**: 5.0 (역할별 테스트 가이드)
